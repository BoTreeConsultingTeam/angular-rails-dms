/* filepreviews 1.4.2 */
!function(){function a(){this._object=!window.XMLHttpRequest||k?new window.ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest.isNormalizedObject?new h:new window.XMLHttpRequest,this._listeners=[]}function b(){return new a}function c(a){if(a._object.send(a._data),i&&!a._async)for(a.readyState=b.OPENED,f(a);a.readyState<b.DONE;)if(a.readyState++,d(a),a._aborted)return}function d(a){b.onreadystatechange&&b.onreadystatechange.apply(a),a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:(new Date).getTime()})}function e(a){var b=a.responseXML,c=a.responseText;return j&&c&&b&&!b.documentElement&&a.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(b=new window.ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.validateOnParse=!1,b.loadXML(c)),b&&(j&&0!=b.parseError||!b.documentElement||b.documentElement&&"parsererror"==b.documentElement.tagName)?null:b}function f(a){try{a.responseText=a._object.responseText}catch(b){}try{a.responseXML=e(a._object)}catch(b){}try{a.status=a._object.status}catch(b){}try{a.statusText=a._object.statusText}catch(b){}}function g(a){a._object.onreadystatechange=new window.Function}var h=window.XMLHttpRequest,i=!!window.controllers,j=!!window.document.namespaces,k=j&&window.navigator.userAgent.match(/MSIE 7.0/);b.prototype=a.prototype,i&&h.wrapped&&(b.wrapped=h.wrapped),b.isNormalizedObject=!0,b.UNSENT=0,b.OPENED=1,b.HEADERS_RECEIVED=2,b.LOADING=3,b.DONE=4,b.prototype.UNSENT=b.UNSENT,b.prototype.OPENED=b.OPENED,b.prototype.HEADERS_RECEIVED=b.HEADERS_RECEIVED,b.prototype.LOADING=b.LOADING,b.prototype.DONE=b.DONE,b.prototype.readyState=b.UNSENT,b.prototype.responseText="",b.prototype.responseXML=null,b.prototype.status=0,b.prototype.statusText="",b.prototype.priority="NORMAL",b.prototype.onreadystatechange=null,b.onreadystatechange=null,b.onopen=null,b.onsend=null,b.onabort=null,b.prototype.open=function(a,c,e,h,k){var l=a.toLowerCase();if("connect"==l||"trace"==l||"track"==l)throw new Error(18);delete this._headers,arguments.length<3&&(e=!0),this._async=e;var m=this,n=this.readyState,o=null;j&&e&&(o=function(){n!=b.DONE&&(g(m),m.abort())},window.attachEvent("onunload",o)),b.onopen&&b.onopen.apply(this,arguments),arguments.length>4?this._object.open(a,c,e,h,k):arguments.length>3?this._object.open(a,c,e,h):this._object.open(a,c,e),this.readyState=b.OPENED,d(this),this._object.onreadystatechange=function(){return!i||e?(m.readyState=m._object.readyState,f(m),m._aborted?void(m.readyState=b.UNSENT):void(m.readyState==b.DONE&&(delete m._data,g(m),j&&e&&window.detachEvent("onunload",o),n!=m.readyState&&d(m),n=m.readyState))):void 0}},b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments),arguments.length||(a=null),a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=a,c(this)},b.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments),this.readyState>b.UNSENT&&(this._aborted=!0),this._object.abort(),g(this),this.readyState=b.UNSENT,delete this._data},b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)},b.prototype.setRequestHeader=function(a,b){return this._headers||(this._headers={}),this._headers[a]=b,this._object.setRequestHeader(a,b)},b.prototype.addEventListener=function(a,b,c){for(var d,e=0;d=this._listeners[e];e++)if(d[0]==a&&d[1]==b&&d[2]==c)return;this._listeners.push([a,b,c])},b.prototype.removeEventListener=function(a,b,c){for(var d,e=0;(d=this._listeners[e])&&(d[0]!=a||d[1]!=b||d[2]!=c);e++);d&&this._listeners.splice(e,1)},b.prototype.dispatchEvent=function(a){var b={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==b.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[b]);for(var c,d=0;c=this._listeners[d];d++)c[0]!=b.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[b])},b.prototype.toString=function(){return"[object XMLHttpRequest]"},b.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]),a.__func=this,a.__func(b[0],b[1],b[2],b[3],b[4]),delete a.__func}),window.XMLHttpRequest=b}(),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.ajax=b()}(this,function(){function a(a,b){b=b||{},b.method=b.method||"GET",b.headers=b.headers||{},b.success=b.success||function(){},b.error=b.error||function(){},b.async="undefined"==typeof b.async?!0:b.async;var c=new XMLHttpRequest;c.open(b.method,a);for(var d in b.headers)b.headers.hasOwnProperty(d)&&c.setRequestHeader(d,b.headers[d]);return c.send(b.data),c.onreadystatechange=function(){4==this.readyState&&200==this.status?b.success(this.responseText,this):4==this.readyState&&b.error(this.status,this.statusText,this)},c}return a}),function(){"use strict";var a,b="https://api.filepreviews.io/v1/";return a=function(a){a=a||{},this.debug=a.debug||!1,this.apiKey=a.apiKey},a.prototype._log=function(a){return this.debug&&console.log(a),this},a.prototype.generate=function(a,b,c){2===arguments.length?"[object Function]"===Object.prototype.toString.call(b)&&(c=b):1===arguments.length&&(b={}),this._submitJobToAPI(a,b,function(a,b){a&&this._log("Error: "+a),this._log("Processing done :)"),c&&c(a,b)}.bind(this))},a.prototype._submitJobToAPI=function(a,c,d){2===arguments.length?"[object Function]"===Object.prototype.toString.call(c)&&(d=c):1===arguments.length&&(c={}),this._log("API request to: "+b);var e=this.getAPIRequestData(a,c),f={"Content-Type":"application/json"};this.apiKey&&(f["X-API-KEY"]=this.apiKey),ajax(b,{headers:f,method:"POST",data:JSON.stringify(e),success:function(a,b){this._log("API request success: "+b.status+" "+b.statusText);var e=JSON.parse(a);this._log("API request response:",e),this._pollForMetadata(e.metadata_url,c,function(a,b){a?d(a):d(null,{metadata:b,previewURL:e.preview_url})}.bind(this))}.bind(this),error:function(a){var b="API request error: ";b+=429===a?"Throttling error, try later":a,this._log(b),d(b)}.bind(this)})},a.prototype._pollForMetadata=function(a,b,c){this._log("Metadata poll url: "+a),2===arguments.length?"[object Function]"===Object.prototype.toString.call(b)&&(c=b):1===arguments.length&&(b={});var d=1,e=1e3,f=function(){this._log("Polling for metadata, tries: "+d),ajax(a,{success:function(a){this._log("Metadata found");var b=JSON.parse(a);b.error?c(b.error):c(null,b)}.bind(this),error:function(){e+=1e3*d,d++,this._log("Metadata not found next try in: "+e/1e3+"s"),setTimeout(f,e)}.bind(this)})}.bind(this);return f()},a.prototype.getAPIRequestData=function(a,b){if(2===arguments.length?"[object Function]"===Object.prototype.toString.call(b)&&(b={},console.log("entro!")):1===arguments.length&&(b={}),b&&(b.url=a,b.size)){var c="";b.size.width&&(c=b.size.width),b.size.height&&(c=c+"x"+b.size.height),b.sizes=[c]}return b},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:window.FilePreviews=a,a}();